# 회원가입 저장 문제 해결 가이드

## 문제 증상
회원가입을 해도 users.yaml 파일에 저장되지 않는 현상

## 원인 분석

### 1. 파일 경로 문제
UserRepository가 파일을 저장하는 경로:
```
{서버실행디렉토리}/data/users.yaml
```

예상 경로: `/Users/jun/Documents/GitHub/LectureReservation/서버/data/users.yaml`

### 2. 확인 사항

#### ✅ 체크리스트
- [ ] 서버 실행 시 콘솔에 `[UserRepository] 파일 저장 완료` 메시지가 출력되는가?
- [ ] `서버/data/` 디렉토리가 존재하는가?
- [ ] `users.yaml` 파일에 쓰기 권한이 있는가?
- [ ] 콘솔에 에러 메시지가 출력되는가?

## 해결 방법

### 방법 1: 디렉토리 확인
```bash
# 서버 폴더로 이동
cd /Users/jun/Documents/GitHub/LectureReservation/서버

# data 디렉토리 확인
ls -la data/

# users.yaml 파일 확인
cat data/users.yaml
```

### 방법 2: 파일 권한 확인
```bash
# 현재 권한 확인
ls -l data/users.yaml

# 필요시 권한 부여
chmod 644 data/users.yaml
```

### 방법 3: 서버 실행 디렉토리 확인
서버를 실행할 때 반드시 **서버 폴더 내에서** 실행해야 합니다:

```bash
# 올바른 실행 방법
cd /Users/jun/Documents/GitHub/LectureReservation/서버
java -jar DeuLectureRoomServer-1.0.0.jar

# 잘못된 실행 방법 (다른 폴더에서 실행)
cd /Users/jun/Documents/GitHub/LectureReservation
java -jar 서버/DeuLectureRoomServer-1.0.0.jar  # ❌ 경로 문제 발생!
```

### 방법 4: 코드 디버깅

UserRepository의 save() 메서드에서 콘솔 로그를 확인하세요:

```java
public BasicResponse save(String number, String pw, String name, String major) {
    try {
        // 중복 체크
        for (User user : users) {
            if (user.number.equals(number)) {
                return new BasicResponse("400", "이미 가입된 사용자 정보 입니다.");
            }
        }

        users.add(new User(number, pw, name, major));
        System.out.println("[DEBUG] 사용자 추가됨: " + number); // 디버그 로그
        
        saveAllToFile(); // 이 메서드가 호출되는지 확인
        
        return new BasicResponse("200", "회원가입 성공");
    } catch (Exception e) {
        System.err.println("[UserRepository] 회원가입 처리 중 오류 발생: " + e.getMessage());
        e.printStackTrace();
        return new BasicResponse("500", "회원가입 실패");
    }
}
```

### 방법 5: 강제 파일 생성 확인

만약 `resources/data/users.yaml`에서 복사가 안 되는 경우:

```bash
# 수동으로 빈 users.yaml 파일 생성
cd /Users/jun/Documents/GitHub/LectureReservation/서버/data
cat > users.yaml << EOF
users: []
EOF
```

## 정상 작동 확인 방법

### 1. 서버 실행 후 콘솔 확인
```
[UserRepository] 파일 로딩 완료: /Users/jun/.../서버/data/users.yaml
[UserRepository] 불러온 사용자 수: X
```

### 2. 회원가입 테스트
```
[UserRepository] 파일 저장 완료: /Users/jun/.../서버/data/users.yaml
```

### 3. 파일 확인
```bash
cat /Users/jun/Documents/GitHub/LectureReservation/서버/data/users.yaml
```

정상적으로 저장되었다면:
```yaml
users:
- number: '20210001'
  password: test1234
  name: 홍길동
  major: 컴퓨터공학과
```

## 추가 참고사항

### UserRepository 코드는 정상입니다
현재 UserRepository.java 코드를 확인한 결과:
- ✅ `save()` 메서드에서 `saveAllToFile()` 호출 확인
- ✅ 파일 저장 로직 정상
- ✅ 디렉토리 자동 생성 로직 포함
- ✅ 에러 처리 구현됨

따라서 문제는 **실행 환경** 또는 **파일 권한**일 가능성이 높습니다.

## 문제가 계속되면

다음 정보를 확인해주세요:
1. 서버 실행 시 콘솔 전체 로그
2. `System.getProperty("user.dir")` 값 (서버가 인식하는 현재 디렉토리)
3. data 폴더 권한 (`ls -la data/`)
4. users.yaml 파일 내용 (`cat data/users.yaml`)

---

**대부분의 경우 서버 실행 위치를 올바르게 하면 해결됩니다!** ✅
